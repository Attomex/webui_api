import React from "react";
import { Alert, Stack, Badge } from "react-bootstrap";
import MessageAlert from "../MessageAlert/MessageAlert";
import LoadingSpinner from "../LoadingSpinner/LoadingSpinner";

const formatDate = (dateString) => {
  const date = new Date(dateString); // Преобразуем строку в объект Date

  const day = String(date.getDate()).padStart(2, "0"); // Получаем день и добавляем ведущий ноль
  const month = String(date.getMonth() + 1).padStart(2, "0"); // Получаем месяц (нумерация с 0)
  const year = date.getFullYear(); // Получаем полный год (например, 2024)

  return `${day}.${month}.${year}`; // Форматируем дату как ДД.ММ.ГГ
};

const LatestVulnerability = ({ latest }) => {
  if (!latest) {
    return (
      <MessageAlert
        message="Данные о последней базе уязвимостей пока недоступны."
        variant="info"
      />
    );
  }
  // Преобразуем дату в нужный формат
  const formattedDate = formatDate(latest.date);

  return (
    <div>
      <Alert style={{ width: "600px", backgroundColor: "rgb(243, 244, 247)" }} variant="light">
        <h4>Последняя база уязвимостей:</h4>
        {Object.keys(latest).length > 0 && (
          <>
            <Stack direction="horizontal" gap={1}>
              <Badge pill bg="info" style={{ color: "black" }}>
                Угроз: {latest.threat_count}
              </Badge>
              <Badge pill bg="info" style={{ color: "black" }}>
                Уязвимостей: {latest.vulnerability_count}
              </Badge>
            </Stack>
            <strong>Дата обновления:</strong> {formattedDate}
            <br />
            <strong>Ссылка:</strong>{" "}
            <a href={latest.link} target="_blank" rel="noopener noreferrer">
              Скачать базу
            </a>
            <br />
          </>
        )}
        {latest.length === 0 && (
          <LoadingSpinner
            text="Загрузка базы"
            animation="border"
            variant="info"
          />
        )}
      </Alert>
    </div>
  );
};

export default LatestVulnerability;
